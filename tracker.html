<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tracker Page</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="trackerContainer">
        <div class="tracker-page-container">
            <!-- Header -->
            <div class="header">
                <h1 class="title">Tracker</h1>
            </div>

            <div class="tracker-section" id="current-challenges">
                <div class="section-header">
                    <h2 class="section-title">Current Challenges</h2>
                    <!-- Edit button for toggling edit mode -->
                    <button id="edit-button" class="edit-mode-button">Edit</button>
                    <!-- <a href="#" class="view-all">VIEW ALL</a> -->
                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üïí</span>
                        </div>
                        <div class="info-text">
                            <h3>Carpool to work</h3>
                            <p>5 days 13 hours left</p>
                            <p>20 points</p>
                        </div>
                    </div>
                    <button class="tracker-edit-btn" onclick="updateScore(20); window.location.href='Carpool.html'">
                        <img src="img/Edit.svg" alt="Edit" class="edit-icon">
                    </button>

                </div>

                <!-- Habit cards will be dynamically inserted here -->
            </div>

            <div class="tracker-section">
                <div class="section-header">
                    <h2 class="section-title">New Challenges</h2>
                    <!-- <a href="#" class="view-all">VIEW ALL</a> -->
                </div>
                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üíß</span>
                        </div>
                        <div class="info-text">
                            <h3>Shorter showers</h3>
                            <p>0/10 TIMES</p>
                            <p>10 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn"
                        onclick="updateScore(10); window.location.href='Showers.html'">+</button>

                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üö∂‚Äç‚ôÇÔ∏è</span>
                        </div>
                        <div class="info-text">
                            <h3>Walk</h3>
                            <p>0/10000 STEPS</p>
                            <p>20 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn"
                        onclick="updateScore(20); window.location.href='Walk.html'">+</button>

                </div>
                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üåø</span>
                        </div>
                        <div class="info-text">
                            <h3>Water Plants</h3>
                            <p>0/1 TIMES</p>
                            <p>10 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn"
                        onclick="updateScore(10); window.location.href='Plants.html'">+</button>

                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">‚Äçüßòüèª‚Äç‚ôÇÔ∏è‚Äç</span>
                        </div>
                        <div class="info-text">
                            <h3>Less electricity</h3>
                            <p>0/1 TIMES</p>
                            <p>30 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn"
                        onclick="updateScore(30); window.location.href='Electricity.html'">+</button>

                </div>

                <!-- Completed Goals Section -->
                <div class="tracker-section" id="completed-goals">
                    <div class="section-header">
                        <h2 class="section-title">Completed Goals</h2>
                    </div>
                    <!-- Completed goals will be dynamically inserted here -->
                </div>

                <!-- Add Habit Link -->
                <a href="addHabit.html" class="add-habit-tracker2">Add Habit</a>
            </div>



            <div class="tracker-bottom-nav">
                <a href="index.html" class="tracker-nav-item">
                    <img src="img/home.svg" alt="Home" class="nav-icon" />
                    Home
                </a>
                <a href="tracker.html" class="tracker-nav-item active">
                    <img src="img/add2.svg" alt="Tracker" class="nav-icon" />
                    Tracker
                </a>
                <a href="Leaderboard.html" class="tracker-nav-item">
                    <img src="img/ranking.svg" alt="Ranking" class="nav-icon" />
                    Ranking
                </a>
                <a href="profile.html" class="tracker-nav-item">
                    <img src="img/profile.svg" alt="Profile" class="nav-icon" />
                    Profile
                </a>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const allHabits = JSON.parse(localStorage.getItem("allHabits")) || [];
                const completedHabits = JSON.parse(localStorage.getItem("completedHabits")) || [];
                const currentChallengesSection = document.getElementById("current-challenges");
                const completedGoalsSection = document.getElementById("completed-goals");

                // Render all current and completed habits
                function renderHabits() {
                    renderCurrentHabits();
                    renderCompletedHabits();
                }

                function renderCurrentHabits() {
                    currentChallengesSection.innerHTML = `<div class="section-header">
            <h2 class="section-title">Current Challenges</h2>
        </div>`; // Reset to include header
                    allHabits.forEach((habit) => {
                        createHabitCard(habit, "current");
                    });
                }

                function renderCompletedHabits() {
                    completedGoalsSection.innerHTML = `<div class="section-header">
            <h2 class="section-title">Completed Challenges</h2>
        </div>`; // Reset to include header
                    completedHabits.forEach((habit) => {
                        createHabitCard(habit, "completed");
                    });
                }

                // Create a habit card for current or completed sections
                function createHabitCard(habit, type) {
                    const challengeCard = document.createElement("div");
                    challengeCard.classList.add("tracker-challenge-card");

                    const challengeInfo = document.createElement("div");
                    challengeInfo.classList.add("tracker-challenge-info");

                    const progressRing = document.createElement("div");
                    progressRing.classList.add("progress-ring");

                    const progressCircle = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    progressCircle.setAttribute("class", "progress-circle");
                    progressCircle.setAttribute("width", "40");
                    progressCircle.setAttribute("height", "40");

                    const progressBackground = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    progressBackground.setAttribute("class", "progress-background");
                    progressBackground.setAttribute("cx", "20");
                    progressBackground.setAttribute("cy", "20");
                    progressBackground.setAttribute("r", "18");

                    const progressValue = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    progressValue.setAttribute("class", "progress-value");
                    progressValue.setAttribute("cx", "20");
                    progressValue.setAttribute("cy", "20");
                    progressValue.setAttribute("r", "18");
                    if (type === "current") {
                        progressValue.setAttribute("stroke-dasharray", "113.1");
                        progressValue.setAttribute("stroke-dashoffset", (113.1 * (1 - habit.completed / habit.goal)).toFixed(2));
                    } else {
                        progressValue.setAttribute("stroke-dashoffset", "0");
                    }

                    progressCircle.appendChild(progressBackground);
                    progressCircle.appendChild(progressValue);
                    progressRing.appendChild(progressCircle);

                    const emoji = document.createElement("span");
                    emoji.classList.add("emoji");
                    emoji.textContent = habit.emoji;
                    progressRing.appendChild(emoji);

                    challengeInfo.appendChild(progressRing);

                    const infoText = document.createElement("div");
                    infoText.classList.add("info-text");

                    const habitTitle = document.createElement("h3");
                    habitTitle.textContent = habit.name;

                    const goalText = document.createElement("p");
                    goalText.textContent = `Goal: ${habit.goal} times`;

                    const completedText = document.createElement("p");
                    completedText.textContent = `Completed: ${habit.completed || 0} / ${habit.goal} times`;

                    infoText.appendChild(habitTitle);
                    infoText.appendChild(goalText);
                    if (type === "current") infoText.appendChild(completedText);

                    challengeInfo.appendChild(infoText);

                    challengeCard.appendChild(challengeInfo);

                    if (type === "current") {
                        // Add the Edit button
                        const editCardButton = document.createElement("button");
                        editCardButton.classList.add("tracker-edit-btn");
                        editCardButton.innerHTML = `<img src="img/Edit.svg" alt="Edit" class="edit-icon">`;
                        editCardButton.onclick = function () {
                            console.log("Editing Habit:", habit); // Debugging: Ensure correct habit is being edited

                            // Save the habit data and its ID for editing
                            localStorage.setItem("editingHabitId", habit.id); // Save the unique habit ID
                            localStorage.setItem("habitToEdit", JSON.stringify(habit)); // Save the habit data

                            // Navigate to the addHabit.html page
                            window.location.href = "addHabit.html";
                        };

                        challengeCard.appendChild(editCardButton);

                        // Add the Complete button
                        const completeButton = document.createElement("button");
                        completeButton.classList.add("tracker-complete-btn");
                        completeButton.textContent = "Complete Goal";
                        completeButton.addEventListener("click", function () {
                            habit.completed = habit.goal;
                            allHabits.splice(allHabits.indexOf(habit), 1); // Remove from current challenges
                            completedHabits.push(habit); // Add to completed habits
                            updateScore(10); // Add 10 points to the user's score
                            localStorage.setItem("allHabits", JSON.stringify(allHabits));
                            localStorage.setItem("completedHabits", JSON.stringify(completedHabits));
                            renderHabits(); // Re-render both sections
                        });
                        challengeCard.appendChild(completeButton);
                    }

                    if (type === "current") {
                        currentChallengesSection.appendChild(challengeCard);
                    } else {
                        completedGoalsSection.appendChild(challengeCard);
                    }
                }

                // Update the user's score
                function updateScore(points) {
                    let userScore = parseInt(localStorage.getItem("userScore")) || 0;
                    userScore += points;
                    localStorage.setItem("userScore", userScore);
                }

                renderHabits(); // Initial rendering
            });
        </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Initialize user's score if not already in localStorage
                if (!localStorage.getItem("userScore")) {
                    localStorage.setItem("userScore", 0);
                }

                // Add any other existing JavaScript code here...

                // Function to update the score
                function updateScore(points) {
                    // Get the current score from localStorage
                    let userScore = parseInt(localStorage.getItem("userScore")) || 0;

                    // Add the points
                    userScore += points;

                    // Save the updated score
                    localStorage.setItem("userScore", userScore);
                }

                // Make the function globally accessible
                window.updateScore = updateScore;
            });
        </script>

</body>

</html>
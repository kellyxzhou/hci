<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tracker Page</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

</head>

<body>
    <div class="trackerContainer">
        <div class="tracker-page-container">
            <!-- Header -->
            <div class="header">
                <h1 class="title">Tracker</h1>
                <!-- <img src="img/settings.png" alt="Settings" class="settings-icon"> -->
            </div>

            <div class="tracker-section" id="current-challenges">
                <div class="section-header">
                    <h2 class="section-title">Current Challenges</h2>
                    <!-- Edit button for toggling edit mode -->
                    <button id="edit-button" class="edit-mode-button">Edit</button>
                    <!-- <a href="#" class="view-all">VIEW ALL</a> -->
                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üïí</span>
                        </div>
                        <div class="info-text">
                            <h3>Carpool to work</h3>
                            <p>5 days 13 hours left</p>
                            <p>20 points</p>
                        </div>
                    </div>
                    <button class="tracker-edit-btn" onclick="updateScore(20); window.location.href='Carpool.html'">
                        <img src="img/Edit.svg" alt="Edit" class="edit-icon">
                    </button>
                    
                </div>

                <!-- Habit cards will be dynamically inserted here -->
            </div>



            <div class="tracker-section">
                <div class="section-header">
                    <h2 class="section-title">New Challenges</h2>
                    <!-- <a href="#" class="view-all">VIEW ALL</a> -->
                </div>
                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üíß</span>
                        </div>
                        <div class="info-text">
                            <h3>Shorter showers</h3>
                            <p>0/10 TIMES</p>
                            <p>10 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn" onclick="updateScore(10); window.location.href='Showers.html'">+</button>

                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üö∂‚Äç‚ôÇÔ∏è</span>
                        </div>
                        <div class="info-text">
                            <h3>Walk</h3>
                            <p>0/10000 STEPS</p>
                            <p>20 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn" onclick="updateScore(20); window.location.href='Walk.html'">+</button>

                </div>
                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">üåø</span>
                        </div>
                        <div class="info-text">
                            <h3>Water Plants</h3>
                            <p>0/1 TIMES</p>
                            <p>10 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn" onclick="updateScore(10); window.location.href='Plants.html'">+</button>

                </div>

                <div class="tracker-challenge-card">
                    <div class="tracker-challenge-info">
                        <div class="progress-ring">
                            <svg class="progress-circle" width="40" height="40">
                                <circle class="progress-background" cx="20" cy="20" r="18"></circle>
                                <circle class="progress-value" cx="20" cy="20" r="18" stroke-dasharray="113.1"
                                    stroke-dashoffset="56.55"></circle>
                            </svg>
                            <span class="emoji">‚Äçüßòüèª‚Äç‚ôÇÔ∏è‚Äç</span>
                        </div>
                        <div class="info-text">
                            <h3>Less electricity</h3>
                            <p>0/1 TIMES</p>
                            <p>30 points</p>
                        </div>
                    </div>
                    <button class="tracker-add-btn" onclick="updateScore(30); window.location.href='Electricity.html'">+</button>

                </div>

                <!-- Add Habit Link -->
                <a href="addHabit.html" class="add-habit-tracker2">Add Habit</a>
            </div>

            <div class="tracker-bottom-nav">
                <a href="index.html" class="tracker-nav-item">
                    <img src="img/home.svg" alt="Home" class="nav-icon" />
                    Home
                </a>
                <a href="tracker.html" class="tracker-nav-item active">
                    <img src="img/add2.svg" alt="Tracker" class="nav-icon" />
                    Tracker
                </a>
                <a href="Leaderboard.html" class="tracker-nav-item">
                    <img src="img/ranking.svg" alt="Ranking" class="nav-icon" />
                    Ranking
                </a>
                <a href="profile.html" class="tracker-nav-item">
                    <img src="img/profile.svg" alt="Profile" class="nav-icon" />
                    Profile
                </a>
            </div>
        </div>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Fetch all habits from localStorage
                const allHabits = JSON.parse(localStorage.getItem("allHabits")) || [];

                // Edit mode flag
                let isEditMode = false;

                // Toggle edit mode
                const editButton = document.getElementById("edit-button");
                const currentChallengesSection = document.getElementById("current-challenges");

                // Add the Edit button functionality
                editButton.addEventListener("click", function () {
                    isEditMode = !isEditMode;
                    // Show or hide the trashcan buttons based on the edit mode
                    const deleteButtons = document.querySelectorAll(".tracker-delete-btn");
                    deleteButtons.forEach(button => {
                        button.style.display = isEditMode ? "inline-block" : "none";
                    });
                });



                // update when user select a challenge
                function updateScore(points) {
                    // Get the current score from localStorage
                     let userScore = parseInt(localStorage.getItem("userScore")) || 0;

                    // Add the points for the completed challenge
                    userScore += points;

                    // Save the updated score to localStorage
                    localStorage.setItem("userScore", userScore);
                }


                // Loop through each habit and render it in the "Current Challenges" section
                allHabits.forEach(function (habit, index) {
                    const challengeCard = document.createElement("div");
                    challengeCard.classList.add("tracker-challenge-card");

                    const challengeInfo = document.createElement("div");
                    challengeInfo.classList.add("tracker-challenge-info");

                    // Create the progress ring
                    const progressRing = document.createElement("div");
                    progressRing.classList.add("progress-ring");
                    const progressCircle = document.createElementNS("http://www.w3.org/2000/svg", "svg");
                    progressCircle.setAttribute("class", "progress-circle");
                    progressCircle.setAttribute("width", "40");
                    progressCircle.setAttribute("height", "40");

                    const progressBackground = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    progressBackground.setAttribute("class", "progress-background");
                    progressBackground.setAttribute("cx", "20");
                    progressBackground.setAttribute("cy", "20");
                    progressBackground.setAttribute("r", "18");

                    const progressValue = document.createElementNS("http://www.w3.org/2000/svg", "circle");
                    progressValue.setAttribute("class", "progress-value");
                    progressValue.setAttribute("cx", "20");
                    progressValue.setAttribute("cy", "20");
                    progressValue.setAttribute("r", "18");
                    progressValue.setAttribute("stroke-dasharray", "113.1");
                    progressValue.setAttribute("stroke-dashoffset", "56.55");

                    progressCircle.appendChild(progressBackground);
                    progressCircle.appendChild(progressValue);
                    progressRing.appendChild(progressCircle);

                    const emoji = document.createElement("span");
                    emoji.classList.add("emoji");
                    emoji.textContent = habit.emoji;

                    progressRing.appendChild(emoji);
                    challengeInfo.appendChild(progressRing);

                    const infoText = document.createElement("div");
                    infoText.classList.add("info-text");

                    const habitTitle = document.createElement("h3");
                    habitTitle.textContent = habit.name;
                    const goalText = document.createElement("p");
                    goalText.textContent = `${habit.goal} times`;

                    infoText.appendChild(habitTitle);
                    infoText.appendChild(goalText);

                    challengeInfo.appendChild(infoText);

                    // Add the edit button (appears in the card itself)
                    const editCardButton = document.createElement("button");
                    editCardButton.classList.add("tracker-edit-btn");
                    editCardButton.innerHTML = `<img src="img/Edit.svg" alt="Edit" class="edit-icon">`;
                    editCardButton.onclick = function () {
                        // Store the habit data in localStorage and redirect to the prefilled page
                        localStorage.setItem("newHabit", JSON.stringify(habit));
                        window.location.href = "addHabit.html"; // Redirect to addhabit.html
                    };

                    // Add the delete button (trashcan button)
                    const deleteButton = document.createElement("button");
                    deleteButton.classList.add("tracker-delete-btn");
                    deleteButton.innerHTML = "üóëÔ∏è";
                    deleteButton.style.display = isEditMode ? "inline-block" : "none";  // Only show in edit mode
                    deleteButton.onclick = function () {
                        // Remove the habit from localStorage
                        allHabits.splice(index, 1);  // Remove the habit at the current index
                        localStorage.setItem("allHabits", JSON.stringify(allHabits));  // Update localStorage

                        // Remove the card from the DOM
                        challengeCard.remove();
                    };

                    // Append all the elements to the card
                    challengeCard.appendChild(challengeInfo);
                    challengeCard.appendChild(editCardButton);
                    challengeCard.appendChild(deleteButton);

                    // Insert the new card into the "Current Challenges" section
                    currentChallengesSection.appendChild(challengeCard);
                });
            });

        </script>
        
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Initialize user's score if not already in localStorage
                if (!localStorage.getItem("userScore")) {
                    localStorage.setItem("userScore", 0);
                }
        
                // Add any other existing JavaScript code here...
        
                // Function to update the score
                function updateScore(points) {
                    // Get the current score from localStorage
                    let userScore = parseInt(localStorage.getItem("userScore")) || 0;
        
                    // Add the points
                    userScore += points;
        
                    // Save the updated score
                    localStorage.setItem("userScore", userScore);
                }
        
                // Make the function globally accessible
                window.updateScore = updateScore;
            });
        </script>
        
</body>

</html>